# Sá»­a Buá»•i há»c - Edit Session

## Wireframe

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9:41   â† Sá»­a buá»•i há»c   [âœ•]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚  ðŸ“ Chá»‰nh sá»­a thÃ´ng tin cÆ¡ báº£n â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ðŸ‘¤ BA BÃ© An â€¢ 5 tuá»•i      â”‚ â”‚ Student info
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚
â”‚  ðŸ“… NgÃ y há»c *                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 22/10/2025            ðŸ“…  â”‚ â”‚ Date picker
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚
â”‚  ðŸ• Buá»•i *                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â— SÃ¡ng      â”‚ â—‹ Chiá»u     â”‚ â”‚ Toggle
â”‚  â”‚ 8:00-11:30  â”‚ 14:00-17:00 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚
â”‚  â° Thá»i gian                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   8:00   â”‚ - â”‚  11:30   â”‚  â”‚ Time picker
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                 â”‚
â”‚  ðŸ“ Ghi chÃº (TÃ¹y chá»n)         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Buá»•i há»c vá» nháº­n diá»‡n mÃ u â”‚ â”‚
â”‚  â”‚ sáº¯c vÃ  váº­n Ä‘á»™ng cÆ¡ báº£n... â”‚ â”‚
â”‚  â”‚                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                 â”‚
â”‚  ðŸ’¡ LÆ°u Ã½:                     â”‚
â”‚  â€¢ KhÃ´ng thá»ƒ sá»­a Ná»™i dung/Má»¥c  â”‚
â”‚    tiÃªu á»Ÿ Ä‘Ã¢y                  â”‚
â”‚  â€¢ Äá»ƒ chá»‰nh sá»­a Ná»™i dung, vÃ o  â”‚
â”‚    pháº§n "Ghi nháº­t kÃ½"          â”‚
â”‚                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                 â”‚
â”‚  âš ï¸ Buá»•i há»c Ä‘Ã£ cÃ³ Ä‘Ã¡nh giÃ¡    â”‚
â”‚  Thay Ä‘á»•i ngÃ y/giá» sáº½ giá»¯ nguyÃªnâ”‚
â”‚  cÃ¡c Ä‘Ã¡nh giÃ¡ Ä‘Ã£ ghi.          â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚    ðŸ’¾ LÆ¯U THAY Äá»”I        â”‚ â”‚ Primary CTA
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚
â”‚  [Há»§y]                          â”‚
â”‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ðŸ ] [ðŸ“ Ghi] [ðŸ“Š BÃ¡o] [ðŸ‘¤ TÃ´i]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Purpose

Screen cho phÃ©p sá»­a thÃ´ng tin **cÆ¡ báº£n** cá»§a buá»•i há»c Ä‘Ã£ táº¡o:

- NgÃ y há»c
- Buá»•i há»c (SÃ¡ng/Chiá»u)
- Thá»i gian cá»¥ thá»ƒ
- Ghi chÃº session

**KHÃ”NG Sá»¬A ÄÆ¯á»¢C:**

- Ná»™i dung dáº¡y há»c (Content)
- Má»¥c tiÃªu (Goals)
- ÄÃ¡nh giÃ¡ Ä‘Ã£ ghi (Logs)

â†’ Äá»ƒ sá»­a Content/Goals, dÃ¹ng chá»©c nÄƒng "Chá»‰nh sá»­a" trong screen 12-log-overview.md

## Components

### Navigation Bar

- **Back button** (â†): Return to previous screen
- **Title**: "Sá»­a buá»•i há»c" (18pt Semibold)
- **Close button** ([âœ•]): Dismiss with confirmation if changed

### Student Info Card (Read-only)

- Student avatar + name
- Cannot change student for existing session

### Form Fields

#### 1. Date Field (Required)

- **Label**: "ðŸ“… NgÃ y há»c \*"
- **Input**: Date picker
- **Current value**: Session date
- **Icon**: ðŸ“… (right side, tap to open picker)
- **Format**: DD/MM/YYYY

#### 2. Session Type (Required)

- **Label**: "ðŸ• Buá»•i \*"
- **Type**: Toggle/Segmented control (2 options)
- **Options**:
  - **SÃ¡ng**: Morning (8:00-11:30)
  - **Chiá»u**: Afternoon (14:00-17:00)
- **Current value**: Session's current type

#### 3. Time Range

- **Label**: "â° Thá»i gian"
- **Type**: Time range picker
- **Format**: HH:MM (24-hour)
- **Current value**: Session's current time
- **Validation**: End time must be after start time

#### 4. Notes (Optional)

- **Label**: "ðŸ“ Ghi chÃº (TÃ¹y chá»n)"
- **Type**: Multi-line text area
- **Current value**: Session notes
- **Max length**: 500 characters

### Info Boxes

#### Note Box (Blue)

- **Icon**: ðŸ’¡
- **Message**: "KhÃ´ng thá»ƒ sá»­a Ná»™i dung/Má»¥c tiÃªu á»Ÿ Ä‘Ã¢y. Äá»ƒ chá»‰nh sá»­a Ná»™i dung, vÃ o pháº§n 'Ghi nháº­t kÃ½'"
- **Purpose**: Clarify scope limitations

#### Warning Box (Orange) - Conditional

- **Icon**: âš ï¸
- **Show when**: Session has evaluation/logs
- **Message**: "Buá»•i há»c Ä‘Ã£ cÃ³ Ä‘Ã¡nh giÃ¡. Thay Ä‘á»•i ngÃ y/giá» sáº½ giá»¯ nguyÃªn cÃ¡c Ä‘Ã¡nh giÃ¡ Ä‘Ã£ ghi."
- **Purpose**: Warn about preserving existing data

### Actions

- **Primary CTA**: [ðŸ’¾ LÆ¯U THAY Äá»”I]
  - Enabled when any field changed
  - Disabled if no changes
- **Cancel**: [Há»§y] text button
  - Show discard confirmation if changed

## Interactions

### Gestures

- **Tap date field** = Open date picker modal
- **Tap session toggle** = Switch between SÃ¡ng/Chiá»u (updates time defaults)
- **Tap time field** = Open time picker modal
- **Tap notes field** = Open keyboard
- **Tap LÆ¯U THAY Äá»”I** = Validate and save
- **Tap Há»§y** = Show discard confirmation if changed

### Validation

- **Date**:
  - Required
  - Cannot be more than 6 months in the past
  - Cannot be more than 1 year in the future
- **Session type**: Required
- **Time**:
  - End time must be after start time
  - Minimum duration: 30 minutes
  - Maximum duration: 8 hours
- **Notes**: Optional, max 500 chars

### Error States

- **Invalid time range**: "Giá» káº¿t thÃºc pháº£i sau giá» báº¯t Ä‘áº§u"
- **Past date warning**: "âš ï¸ NgÃ y nÃ y Ä‘Ã£ qua, báº¡n cÃ³ cháº¯c cháº¯n?"
- **Conflict warning** (if applicable): "âš ï¸ ÄÃ£ cÃ³ buá»•i há»c khÃ¡c vÃ o thá»i gian nÃ y"

### Navigation

- **Back/Close button** â†’ Confirmation if data changed, else return to previous
- **Cancel button** â†’ Same as Back/Close
- **LÆ¯U THAY Äá»”I** â†’ Save and return to previous screen
  - Update calendar view
  - Show success toast: "âœ… ÄÃ£ lÆ°u thay Ä‘á»•i"

### Discard Changes Confirmation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš ï¸ Há»§y thay Ä‘á»•i?               â”‚
â”‚                                 â”‚
â”‚  Báº¡n cÃ³ thay Ä‘á»•i chÆ°a lÆ°u.      â”‚
â”‚  Náº¿u thoÃ¡t, má»i thay Ä‘á»•i sáº½ bá»‹  â”‚
â”‚  máº¥t.                           â”‚
â”‚                                 â”‚
â”‚  [á»ž Láº I]  [THOÃT]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Entry Points

### From Student Detail (Screen 02)

```
Session card menu â‹® â†’ "Sá»­a buá»•i há»c" â†’ 04a-edit-session.md
```

**Long press or tap â‹® on session card:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœï¸ Sá»­a buá»•i há»c     â”‚
â”‚ ðŸ—‘ï¸ XÃ³a buá»•i há»c     â”‚
â”‚ ðŸ“‹ Sao chÃ©p         â”‚
â”‚ âŒ Há»§y              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### From Log Overview (Screen 12)

```
Menu â‹® (top right) â†’ "Sá»­a thÃ´ng tin buá»•i há»c" â†’ 04a-edit-session.md
```

**Menu options:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœï¸ Sá»­a thÃ´ng tin buá»•i há»câ”‚
â”‚ ðŸ—‘ï¸ XÃ³a buá»•i há»c         â”‚
â”‚ ðŸ“¤ Xuáº¥t bÃ¡o cÃ¡o         â”‚
â”‚ âŒ Há»§y                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Exit Points

- **Save success** â†’ Return to previous screen (02 or 12) with updated data
- **Cancel/Close** â†’ Return to previous screen (no changes)

## API Integration

### Load Session Data

```javascript
GET /api/sessions/:sessionId

Response:
{
  "id": "sess_123",
  "studentId": "std_1",
  "date": "2025-10-22",
  "timeSlot": "morning",
  "startTime": "08:00",
  "endTime": "11:30",
  "notes": "Buá»•i há»c vá» nháº­n diá»‡n mÃ u sáº¯c...",
  "hasEvaluation": true, // Show warning box
  "contentCount": 5,
  "evaluationProgress": {
    "completed": true,
    "timestamp": "2025-10-22T11:30:00Z"
  }
}
```

### Update Session

```javascript
PATCH /api/sessions/:sessionId

Request:
{
  "date": "2025-10-23",
  "timeSlot": "afternoon",
  "startTime": "14:00",
  "endTime": "16:30",
  "notes": "Updated notes..."
}

Response:
{
  "success": true,
  "message": "Session updated successfully",
  "session": { ... }
}
```

## Business Logic

### What Changes Are Preserved

âœ… **Preserved when editing:**

- All Content items
- All Goals
- All Evaluations/Logs
- Behavior records
- Teacher notes
- Media attachments

### What Can Be Changed

âœ… **Editable fields:**

- Date
- Session type (SÃ¡ng/Chiá»u)
- Start time
- End time
- Session-level notes

### Validation Rules

1. Cannot change student (session belongs to specific student)
2. Cannot edit Content/Goals here (use screen 12 edit flow)
3. Date changes don't affect evaluation validity
4. Time changes don't affect logged data
5. Warn if changing date significantly (>7 days) with existing evaluation

## Related Screens

- **Entry from**: 02-student-detail.md, 12-log-overview.md
- **Related**: 04-manual-step1.md (similar form for creation)
- **Confirmation**: 30-confirmations.md (Discard changes)

## Notes

- **Scope limitation intentional**: Separating basic info edit from content edit reduces complexity
- **Data integrity**: Preserving evaluations when changing date/time maintains historical accuracy
- **UX clarity**: Clear notes explain what can/cannot be edited here
- **Accessibility**: All fields have VoiceOver labels, required fields announced
- **Auto-save**: Not implemented here (simple form, quick edit)
- **Conflict detection**: Optional - warn if new time conflicts with other sessions

## Design Rationale

**Why separate basic info edit from content edit?**

1. **Different contexts**: Basic info = administrative correction, Content = pedagogical changes
2. **Access control**: Teachers may need different permissions for each
3. **Complexity**: Keep forms focused and simple
4. **Validation**: Different validation rules for each type of edit
5. **Data integrity**: Prevent accidental changes to evaluated content

**Why allow date/time changes after evaluation?**

1. **Flexibility**: Teachers may need to correct mistakes (wrong date entered)
2. **Reality**: Actual session time may differ from plan
3. **Transparency**: Warnings inform about existing data
4. **Audit trail**: System logs changes for accountability
